<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Tableau de bord Administrateur</title>
  <link rel="stylesheet" href="../css/styles.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(to bottom right, #f0f4f8, #dfe9f3);
      color: #333;
    }

    header {
      background-color: #3f51b5;
      color: white;
      padding: 20px 0;
      text-align: center;
    }
     <nav>
    <a href="student.html">√âtudiant</a>
    <a href="teacher.html">Enseignant</a>
    <a href="admin.html">Administrateur</a>
  </nav>

    main {
      max-width: 900px;
      margin: 30px auto;
      padding: 0 20px;
    }

    h2 {
      margin-top: 40px;
      color: #3f51b5;
      font-size: 22px;
      text-align: center;
    }

    .form-container, .actions {
      background-color: white;
      padding: 30px;
      margin-top: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }

    input, select {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }

    button {
      display: inline-block;
      background-color: #4CAF50;
      color: white;
      padding: 12px 24px;
      margin: 5px 0;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover {
      background-color: #388e3c;
    }

    table {
      width: 100%;
      margin-top: 15px;
      border-collapse: collapse;
      background-color: white;
      font-size: 16px;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 10px;
      text-align: center;
    }

    th {
      background-color: #e3eaf2;
    }

    /* Styles pour la barre de recherche */
    #searchInput {
      width: 100%;
      padding: 10px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }

    /* Message quand aucun cr√©neau */
    #emptyMessage {
      text-align: center;
      color: #888;
      font-style: italic;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Tableau de bord Administrateur</h1>
  </header>

  <main>
    <!-- Formulaire d'ajout de cr√©neau -->
    <section class="form-container" aria-labelledby="formTitle">
      <h2 id="formTitle">Ajouter un cr√©neau</h2>
      <form id="addSlotForm" aria-describedby="formDesc">
        <p id="formDesc" style="display:none;">Formulaire pour ajouter un cr√©neau horaire.</p>
        <label for="day">Jour :</label>
        <select id="day" required aria-required="true" aria-label="Jour du cr√©neau">
          <option value="">-- Choisir un jour --</option>
          <option>Lundi</option>
          <option>Mardi</option>
          <option>Mercredi</option>
          <option>Jeudi</option>
          <option>Vendredi</option>
          <option>Samedi</option>
        </select>

        <label for="time">Heure :</label>
        <input type="time" id="time" required aria-required="true" aria-label="Heure du cr√©neau">

        <label for="subject">Mati√®re :</label>
        <input type="text" id="subject" required placeholder="Ex: Physique" aria-required="true" aria-label="Mati√®re">

        <button type="submit" aria-label="Ajouter un cr√©neau">‚ûï Ajouter</button>
      </form>
    </section>

    <!-- Recherche -->
    <section class="actions" aria-labelledby="searchTitle">
      <h2 id="searchTitle">Rechercher un cr√©neau</h2>
      <input
        type="text"
        id="searchInput"
        placeholder="Rechercher par jour ou mati√®re..."
        aria-label="Recherche dans les cr√©neaux"
      />
    </section>

    <!-- Liste des cr√©neaux -->
    <section class="actions" aria-labelledby="slotsTitle">
      <h2 id="slotsTitle">Liste des cr√©neaux</h2>
      <table id="slotsTable" role="grid" aria-describedby="emptyMessage">
        <thead>
          <tr>
            <th scope="col">Jour</th>
            <th scope="col">Heure</th>
            <th scope="col">Mati√®re</th>
            <th scope="col">Action</th>
          </tr>
        </thead>
        <tbody>
          <!-- Cr√©neaux ajout√©s dynamiquement -->
        </tbody>
      </table>
      <p id="emptyMessage" style="display:none;">Aucun cr√©neau ajout√©.</p>
      <button onclick="exportPDF()" aria-label="Exporter la liste des cr√©neaux en PDF">üì§ Exporter en PDF</button>
    </section>

    <!-- Utilisateurs fictifs -->
    <section class="actions" aria-labelledby="usersTitle">
      <h2 id="usersTitle">Utilisateurs (fictifs)</h2>
      <ul id="userList">
        <li>üë§ menrick MENGA - √âtudiant</li>
        <li>üë§ MENGA MENGA  - Enseignante</li>
        <li>üë§ PR MENGA PATRICK - Administrateur</li>
      </ul>
    </section>
  </main>

  <script>
    const form = document.getElementById('addSlotForm');
    const tableBody = document.querySelector('#slotsTable tbody');
    const searchInput = document.getElementById('searchInput');
    const emptyMessage = document.getElementById('emptyMessage');

    // Ordre des jours pour le tri
    const daysOrder = ['Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];

    // Fonction pour mettre √† jour l'affichage du message "Aucun cr√©neau"
    function updateEmptyMessage() {
      emptyMessage.style.display = tableBody.children.length === 0 ? 'block' : 'none';
    }

    // Fonction pour v√©rifier doublon (jour + heure)
    function isDuplicate(day, time) {
      for (let row of tableBody.rows) {
        const rDay = row.cells[0].textContent.trim();
        const rTime = row.cells[1].textContent.trim();
        if (rDay === day && rTime === time) {
          return true;
        }
      }
      return false;
    }

    // Fonction pour trier les lignes du tableau par jour puis heure
    function sortTable() {
      const rows = Array.from(tableBody.rows);
      rows.sort((a, b) => {
        const dayA = a.cells[0].textContent.trim();
        const dayB = b.cells[0].textContent.trim();
        const timeA = a.cells[1].textContent.trim();
        const timeB = b.cells[1].textContent.trim();

        // Trier par jour
        const dayDiff = daysOrder.indexOf(dayA) - daysOrder.indexOf(dayB);
        if (dayDiff !== 0) return dayDiff;

        // Puis par heure (format HH:mm)
        return timeA.localeCompare(timeB);
      });

      // R√©-injecter dans tbody
      tableBody.innerHTML = '';
      for (const row of rows) {
        tableBody.appendChild(row);
      }
    }

    // Fonction d'ajout de cr√©neau
    form.addEventListener('submit', function(e) {
      e.preventDefault();
      const day = document.getElementById('day').value;
      const time = document.getElementById('time').value;
      const subject = document.getElementById('subject').value.trim();

      if (!day || !time || !subject) {
        alert("Veuillez remplir tous les champs.");
        return;
      }

      if (isDuplicate(day, time)) {
        alert(`Un cr√©neau existe d√©j√† pour ${day} √† ${time}.`);
        return;
      }

      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${day}</td>
        <td>${time}</td>
        <td>${subject}</td>
        <td><button aria-label="Supprimer ce cr√©neau" class="delete-btn">‚ùå Supprimer</button></td>
      `;
      tableBody.appendChild(row);

      form.reset();
      updateEmptyMessage();
      sortTable();
    });

    // Gestion d√©l√©gation suppression avec confirmation
    tableBody.addEventListener('click', function(e) {
      if (e.target && e.target.classList.contains('delete-btn')) {
        const btn = e.target;
        if (confirm('Voulez-vous vraiment supprimer ce cr√©neau ?')) {
          const row = btn.closest('tr');
          row.remove();
          updateEmptyMessage();
        }
      }
    });

    // Recherche dans le tableau
    searchInput.addEventListener('input', function() {
      const filter = this.value.toLowerCase();
      let visibleCount = 0;

      for (let row of tableBody.rows) {
        const day = row.cells[0].textContent.toLowerCase();
        const time = row.cells[1].textContent.toLowerCase();
        const subject = row.cells[2].textContent.toLowerCase();

        if (day.includes(filter) || subject.includes(filter)) {
          row.style.display = '';
          visibleCount++;
        } else {
          row.style.display = 'none';
        }
      }

      // Afficher message si aucun r√©sultat visible
      emptyMessage.textContent = visibleCount === 0 ? 'Aucun cr√©neau trouv√©.' : 'Aucun cr√©neau ajout√©.';
      emptyMessage.style.display = tableBody.children.length === 0 || visibleCount === 0 ? 'block' : 'none';
    });

    // Export PDF
    function exportPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      doc.text("Cr√©neaux r√©serv√©s", 14, 15);

      // On r√©cup√®re uniquement les lignes visibles (non display:none)
      const visibleRows = Array.from(tableBody.rows).filter(row => row.style.display !== 'none');
      if (visibleRows.length === 0) {
        alert("Aucun cr√©neau √† exporter.");
        return;
      }

      // Construire un tableau pour autoTable
      const data = visibleRows.map(row => [
        row.cells[0].textContent,
        row.cells[1].textContent,
        row.cells[2].textContent,
      ]);

      doc.autoTable({
        head: [['Jour', 'Heure', 'Mati√®re']],
        body: data,
        startY: 20,
        styles: { halign: 'center' },
      });

      doc.save("creneaux.pdf");
    }

    // Mettre √† jour l'√©tat du message vide au chargement
    updateEmptyMessage();

    // Exposer exportPDF pour l'appel onclick dans HTML
    window.exportPDF = exportPDF;
  </script>
</body>
</html>
